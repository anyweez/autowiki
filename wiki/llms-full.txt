# autowiki Wiki - Complete Content

This file contains the complete content of all wiki pages for AI context.

================================================================================

FILE: wiki/overview.md
----------------------------------------
---
title: autowiki
type: overview
tags: [claude-code, plugin, documentation, wiki, npm]
sources:
  - ./
  - plugins/autowiki/
---

# autowiki

Auto-generated wiki documentation for your codebase, built by AI agents and browsable by humans. The project has two parts: a **Claude Code plugin** that builds and maintains a wiki, and an **npm package** (`npx autowiki`) that serves it as a searchable website.

## Architecture

```
User Command (/autowiki:init, /autowiki:update, etc.)
         |
         v
+------------------+     +-------------------+
| Command Handler  | --> | Wiki Explorer(s)  |  (parallel exploration)
|  (commands/*.md) |     | (agents/wiki-     |
+------------------+     |  explorer.md)     |
         |               +-------------------+
         |                        |
         v                        v
+------------------+     +-------------------+
| Wiki Coordinator | <-- | Explorer Outputs  |
| (agents/wiki-    |     | (findings, refs)  |
|  coordinator.md) |     +-------------------+
+------------------+
         |
         v
+------------------+     +-------------------+
| Generated Wiki   | --> | npx autowiki      |
| (wiki/*.md)      |     | (bin/autowiki.js) |
+------------------+     | (lib/server.js)   |
                         +-------------------+
```

## Core Concepts

- [[Commands]] - Three user-invokable commands (init, update, reorganize)
- [[Agents]] - Wiki Explorer and Wiki Coordinator sub-agents
- [[Scripts]] - Node.js utilities for llms.txt generation and wiki serving
- [[Configuration]] - YAML config, data structures, and auto-update hooks

## Getting Started

### Install the Claude Code plugin

In Claude Code, run:

```
/plugins
```

Select **Add a marketplace**, then enter:

```
anyweez/autowiki
```

Then select **autowiki** from the marketplace to install it.

### Generate your wiki

```
/autowiki:init
```

Claude will explore your codebase and create a `wiki/` directory with structured documentation.

### Browse it

```bash
npx autowiki
```

Open http://localhost:3000 and you're in.

## Plugin Commands

| Command | Purpose |
|---------|---------|
| `/autowiki:init` | Bootstrap wiki from codebase |
| `/autowiki:update` | Update wiki after code changes |
| `/autowiki:reorganize` | Restructure wiki if needed |

## Web Server Options

```
npx autowiki [options]

  --port <number>     Port to listen on (default: 3000)
  --wiki-dir <path>   Wiki directory (default: auto-detect)
  --export            Export static HTML files
  --output <path>     Export directory (default: wiki-html/)
  --open              Open browser automatically
```

## Directory Structure

```
bin/
  autowiki.js              - CLI entry point for npx autowiki
lib/
  highlight.js             - Syntax highlighting for code blocks
  renderer.js              - Markdown rendering pipeline
  scanner.js               - Wiki page scanner and frontmatter parser
  server.js                - HTTP server with wikilink support
  template.js              - HTML template and styling
package.json               - npm package config (autowiki)

plugins/autowiki/
  .claude-plugin/
    plugin.json            - Plugin manifest
  agents/
    wiki-explorer.md       - [[Agents|Explorer agent]] instructions
    wiki-coordinator.md    - [[Agents|Coordinator agent]] instructions
  commands/
    init.md                - [[Commands|/autowiki:init]] command
    update.md              - [[Commands|/autowiki:update]] command
    reorganize.md          - [[Commands|/autowiki:reorganize]] command
    serve.md               - Deprecated, redirects to npx autowiki
  hooks/
    post-task.sh           - [[Configuration|Auto-update hook]]
  scripts/
    generate-llms.js       - [[Scripts|llms.txt generator]]
  package.json             - Plugin Node.js dependencies

.claude-plugin/
  marketplace.json         - Plugin distribution config
```

## Requirements

- [Claude Code](https://docs.anthropic.com/en/docs/claude-code) (for the plugin)
- Node.js 16+ (for the web server)


================================================================================

FILE: wiki/agents.md
----------------------------------------
---
title: Agents
type: concept
tags: [agents, exploration, coordination, sub-agents]
related:
  - "[[Commands]]"
  - "[[Architecture]]"
sources:
  - plugins/autowiki/agents/
---

# Agents

The autowiki plugin uses two specialized sub-agents to explore codebases and synthesize documentation. These agents are defined as markdown instruction files that Claude Code launches as Task sub-agents.

## Wiki Explorer Agent

**File**: `plugins/autowiki/agents/wiki-explorer.md`

The explorer agent analyzes assigned code partitions and produces structured findings for the coordinator.

### Role

From `wiki-explorer.md:6-11`:
- Understand what components exist and what they do
- How they work internally
- How they relate to other parts of the codebase
- Key patterns, conventions, and architectural decisions

### Input

Explorers receive:
```
Partition: [list of directories/files to explore]
Context: [brief description of expected contents]
Existing wiki pages: [list of current pages, if updating]
```

### Exploration Process

1. **Survey the partition** - List files, identify entry points, note conventions (`wiki-explorer.md:29-34`)
2. **Read key files** - Prioritize entry points, types, core implementation, config, tests (`wiki-explorer.md:36-42`)
3. **Identify concepts** - Find coherent units of functionality (`wiki-explorer.md:44-50`)
4. **Document relationships** - Dependencies, dependents, data flow (`wiki-explorer.md:52-58`)
5. **Capture code references** - Specific file paths with line numbers (`wiki-explorer.md:60-66`)

### Output Format

```markdown
# Exploration Report: [Partition Name]

## Summary
Brief overview of partition contents and role.

## Discovered Concepts

### Concept: [Name]
**Description**: What this concept is and does
**Type**: feature | service | utility | integration | pattern
**Key Files**:
- `path/to/file.ts` - Primary implementation

**Behavior**:
- How it works
- Key algorithms or patterns

**Dependencies**:
- Uses [[Other Concept]] for X

**Code References**:
- Main entry: `src/feature/index.ts:1`
- Core logic: `src/feature/handler.ts:25-80`

---

## Cross-Partition Dependencies
[Concepts that depend on or are depended upon by other partitions]

## Suggested Wiki Structure
[How to organize wiki pages for this partition]

## Open Questions
[Things that need clarification]
```

### Guidelines

**Do**:
- Read actual code, don't guess from filenames
- Follow imports to understand dependencies
- Note patterns that appear repeatedly
- Include line numbers for key locations

**Don't**:
- Explore outside assigned partition
- Make assumptions about unread code
- Document obvious/trivial things
- Include non-architectural implementation details

See `wiki-explorer.md:126-138`.

---

## Wiki Coordinator Agent

**File**: `plugins/autowiki/agents/wiki-coordinator.md`

The coordinator synthesizes explorer findings into cohesive wiki documentation.

### Role

From `wiki-coordinator.md:6-12`:
1. Synthesize findings into coherent wiki pages
2. Resolve cross-partition dependencies
3. Create consistent page structure
4. Ensure all wikilinks are valid
5. Generate supporting index files

### Input

Coordinators receive:
```
Mode: init | update
Explorer outputs: [collected reports from all explorers]
Existing wiki: [current pages and structure, if updating]
Config: [wiki/.config.yml contents]
```

### Init Mode Process

1. **Consolidate concepts** - Merge findings, resolve naming conflicts, identify gaps (`wiki-coordinator.md:28-33`)
2. **Design page structure** - Create hierarchy respecting max_root_pages limit (`wiki-coordinator.md:35-52`)
3. **Write pages** - Generate complete content with frontmatter (`wiki-coordinator.md:54-102`)
4. **Create overview** - Special entry point page (`wiki-coordinator.md:104-150`)
5. **Build index** - Generate `.index.json` with metadata (`wiki-coordinator.md:152-185`)
6. **Validate** - Check all wikilinks resolve, no orphans (`wiki-coordinator.md:187-193`)

### Update Mode Process

1. **Identify changes** - Categorize as update/create/delete/rename (`wiki-coordinator.md:197-203`)
2. **Apply updates** - Preserve structure, update affected sections (`wiki-coordinator.md:205-225`)
3. **Update index** - Regenerate `.index.json` (`wiki-coordinator.md:227-229`)
4. **Validate** - Same as init mode (`wiki-coordinator.md:231-232`)

### Page Structure Rules

From `wiki-coordinator.md:48-51`:
- No more than 15 pages at root level
- Create subdirectory if topic has 3+ related concepts
- Every page must have at least one incoming link

### Writing Guidelines

**Voice and Style** (`wiki-coordinator.md:245-249`):
- Write for AI agents as primary audience
- Be precise and unambiguous
- Include concrete code references
- Avoid marketing language or fluff

**Content Priorities** (`wiki-coordinator.md:251-255`):
1. What does this do? (purpose)
2. How does it work? (mechanism)
3. Where is it? (code locations)
4. How does it connect? (relationships)

**Code References** (`wiki-coordinator.md:257-260`):
- Good: `src/auth/middleware.ts:42`
- Bad: "in the auth middleware"

### Output

1. All wiki page contents (as file writes)
2. The `.index.json` content
3. Summary of pages created/updated/deleted
4. Any warnings (broken links, orphan pages)

---

## Agent Communication Pattern

```
Command
   |
   +-- launches --> Explorer 1 (partition A)
   |                    |
   +-- launches --> Explorer 2 (partition B)
   |                    |
   +-- launches --> Explorer 3 (partition C)
   |                    |
   +-- waits for all ----+
   |
   +-- collects outputs
   |
   +-- launches --> Coordinator
                        |
                    writes wiki pages
```

## Code References

- `plugins/autowiki/agents/wiki-explorer.md` - Explorer instructions
- `plugins/autowiki/agents/wiki-coordinator.md` - Coordinator instructions


================================================================================

FILE: wiki/architecture.md
----------------------------------------
---
title: Architecture
type: concept
tags: [architecture, design, flow]
related:
  - "[[Commands]]"
  - "[[Agents]]"
  - "[[Configuration]]"
sources:
  - plugins/autowiki/
  - bin/
  - lib/
---

# Architecture

autowiki has two main components: a **Claude Code plugin** (`plugins/autowiki/`) that generates and maintains wiki content, and an **npm package** (`bin/` + `lib/`) that serves the wiki as a website. The plugin follows a command-agent-script architecture where user commands orchestrate specialized agents that produce wiki content, supported by utility scripts for indexing.

## System Flow

### Initialization Flow (/autowiki:init)

```
1. User runs /autowiki:init
2. Command handler (commands/init.md) executes
3. Pre-flight: Check wiki/ doesn't exist
4. Create default wiki/.config.yml
5. Analyze codebase structure
6. Partition codebase for parallel exploration
7. Launch wiki-explorer agents (up to 4 concurrent)
8. Collect explorer outputs
9. Launch wiki-coordinator agent
10. Coordinator writes wiki pages
11. Run generate-llms.js
12. Report completion
```

### Update Flow (/autowiki:update)

```
1. User runs /autowiki:update (or auto-triggered)
2. Command handler (commands/update.md) executes
3. Pre-flight: Check wiki/ exists
4. Detect changes via git diff since wiki/.last-update
5. Map changed files to affected wiki pages via .index.json
6. Launch targeted wiki-explorer agents
7. Collect focused update outputs
8. Launch wiki-coordinator in update mode
9. Coordinator applies incremental updates
10. Regenerate llms.txt files
11. Update wiki/.last-update marker
```

## Component Responsibilities

### Commands Layer

Commands are markdown files with embedded instructions that Claude Code executes as slash commands.

| File | Command | Role |
|------|---------|------|
| `commands/init.md` | `/autowiki:init` | Orchestrates full wiki creation |
| `commands/update.md` | `/autowiki:update` | Orchestrates incremental updates |
| `commands/reorganize.md` | `/autowiki:reorganize` | Analyzes and restructures wiki |
| `commands/serve.md` | `/autowiki:serve` | Deprecated, redirects to `npx autowiki` |

### Agents Layer

Agents are specialized sub-agents launched by commands to perform focused tasks.

| Agent | Role | Input | Output |
|-------|------|-------|--------|
| Wiki Explorer | Explore code partition | Directory list, context | Concept list, code refs |
| Wiki Coordinator | Synthesize findings | Explorer outputs | Wiki pages, index |

### npm Package (Web Server)

The web server is distributed as an npm package for browsing wikis locally.

| File | Purpose |
|------|---------|
| `bin/autowiki.js` | CLI entry point, argument parsing, wiki directory auto-detection |
| `lib/server.js` | HTTP server with routing, wikilink resolution, static export |
| `lib/renderer.js` | Markdown rendering pipeline |
| `lib/scanner.js` | Wiki page scanner and frontmatter parser |
| `lib/highlight.js` | Syntax highlighting for code blocks |
| `lib/template.js` | HTML template with sidebar, search, dark mode styling |

### Scripts Layer

Utility scripts that support wiki functionality.

| Script | Language | Purpose |
|--------|----------|---------|
| `generate-llms.js` | Node.js | Generate llms.txt index files |

### Data Layer

Generated files that comprise the wiki.

| File | Purpose |
|------|---------|
| `wiki/.config.yml` | Configuration settings |
| `wiki/.index.json` | Page metadata and source mapping |
| `wiki/.last-update` | Git commit hash of last update |
| `wiki/llms.txt` | AI-friendly page index |
| `wiki/llms-full.txt` | Complete content dump |
| `wiki/*.md` | Documentation pages |

## Key Design Decisions

### Two-Part Distribution

The project is split into a Claude Code plugin (for wiki generation) and an npm package (for wiki viewing). This allows:
- Wiki generation to happen within Claude Code's agent framework
- Wiki browsing to work independently via `npx autowiki` with zero configuration
- The generated markdown to be useful on its own (for AI agents via `llms.txt`)

### Parallel Exploration

The init command partitions the codebase and launches multiple explorer agents concurrently. This design:
- Reduces total exploration time
- Allows specialized focus per partition
- Requires coordination to merge findings

See `commands/init.md:49-84` for partitioning logic.

### Git-Based Change Detection

Updates use git to identify what changed:
- Compares current HEAD to `wiki/.last-update` commit
- Maps changed files to wiki pages via `source_map` in `.index.json`
- Only re-explores affected areas

See `commands/update.md:20-29` for change detection.

### Wikilink System

Pages connect via `[[wikilinks]]` resolved at render time:
1. Check exact title match
2. Check aliases in `.index.json`
3. Fall back to slugified filename

See `lib/scanner.js` for resolution logic.

## Extension Points

### Adding New Commands

1. Create `commands/your-command.md` with frontmatter
2. Command auto-registers via Claude Code plugin system
3. Follow existing command structure (pre-flight, process, output)

### Custom Exploration

Modify `agents/wiki-explorer.md` to:
- Change what constitutes a "concept"
- Adjust output format
- Add domain-specific analysis

### Alternative Outputs

The coordinator can be extended to generate:
- Different documentation formats
- API documentation
- Dependency graphs

## Related Concepts

- [[Commands]] - Detailed command documentation
- [[Agents]] - Agent instruction details
- [[Configuration]] - Customization options


================================================================================

FILE: wiki/commands.md
----------------------------------------
---
title: Commands
type: reference
tags: [commands, cli, usage]
related:
  - "[[Architecture]]"
  - "[[Agents]]"
  - "[[Configuration]]"
sources:
  - plugins/autowiki/commands/
---

# Commands

The autowiki plugin provides three user-invokable commands, each defined as a markdown file in `plugins/autowiki/commands/`. Commands are namespaced with the `autowiki:` prefix when installed as a plugin. A fourth command (`serve`) exists but is deprecated in favor of `npx autowiki`.

## /autowiki:init

**File**: `plugins/autowiki/commands/init.md`

Initializes a new wiki by exploring the codebase with parallel sub-agents.

### Process

1. **Pre-flight checks** - Verifies wiki/ doesn't already exist (`init.md:10-14`)
2. **Load/create configuration** - Creates `wiki/.config.yml` with defaults (`init.md:17-39`)
3. **Discover structure** - Analyzes top-level directories, module boundaries, entry points (`init.md:41-48`)
4. **Partition work** - Divides codebase into logical partitions for parallel exploration (`init.md:49-61`)
5. **Launch explorers** - Spawns wiki-explorer agents (up to 4 concurrent) (`init.md:63-84`)
6. **Coordinate** - Launches wiki-coordinator to synthesize findings (`init.md:86-101`)
7. **Generate index** - Runs `generate-llms.js` to create llms.txt files (`init.md:103-113`)

### Output

Creates the wiki directory structure:

```
wiki/
  .config.yml       - Configuration
  .index.json       - Page index
  llms.txt          - AI-friendly index
  llms-full.txt     - Full content dump
  overview.md       - Repository overview
  [concept].md      - Concept pages
```

### Usage

```
/autowiki:init
```

### Error Handling

- If wiki exists: Stops with message to use `/autowiki:update` or delete wiki/
- If exploration fails: Logs error, continues with other partitions
- If coordination fails: Saves raw outputs to `wiki/.raw/`

---

## /autowiki:update

**File**: `plugins/autowiki/commands/update.md`

Updates the wiki to reflect recent changes in the codebase.

### Process

1. **Pre-flight checks** - Verifies wiki/ exists (`update.md:10-12`)
2. **Detect changes** - Uses git diff against `wiki/.last-update` commit (`update.md:16-29`)
3. **Map to pages** - Consults `.index.json` source_map to find affected pages (`update.md:31-56`)
4. **Analyze impact** - Categorizes as minor/moderate/major (`update.md:58-64`)
5. **Launch explorers** - Targeted exploration of affected areas (`update.md:66-90`)
6. **Apply updates** - Coordinator applies incremental changes (`update.md:92-109`)
7. **Finalize** - Regenerates llms.txt, updates `.last-update` marker (`update.md:111-122`)

### Change Detection

```bash
# From update.md:20-29
LAST_UPDATE=$(cat wiki/.last-update 2>/dev/null || echo "")
if [ -z "$LAST_UPDATE" ]; then
  CHANGED_FILES=$(git diff --name-only HEAD~10)
else
  CHANGED_FILES=$(git diff --name-only $LAST_UPDATE HEAD)
fi
```

### Minimal Changes Mode

For trivial changes (only affects code references, not behavior):
- Skips full exploration
- Only updates line numbers in code references
- Quick validation that referenced files exist

See `update.md:131-137`.

### Usage

```
/autowiki:update
```

Or configure auto-update in `wiki/.config.yml`:
```yaml
auto_update: true
```

---

## /autowiki:reorganize

**File**: `plugins/autowiki/commands/reorganize.md`

Analyzes wiki structure and suggests/applies improvements.

### Process

1. **Analyze structure** - Gathers metrics per page (lines, sections, links, sources) (`reorganize.md:16-28`)
2. **Identify signals** - Checks for split, merge, or restructure indicators (`reorganize.md:30-51`)
3. **Generate recommendations** - Creates prioritized list of changes (`reorganize.md:53-87`)
4. **User decision** - Presents options (apply all, high-priority only, review each, skip) (`reorganize.md:89-108`)
5. **Apply changes** - Executes approved reorganizations (`reorganize.md:110-132`)
6. **Validate** - Verifies all wikilinks resolve, regenerates index (`reorganize.md:133-139`)

### Reorganization Signals

**Split signals** (page too large):
- Exceeds 500 lines
- More than 8 top-level sections
- Covers more than 10 source files
- Has "and" in title

**Merge signals** (pages too fragmented):
- Under 50 lines
- Only 1-2 incoming links
- Overlapping sources
- Always referenced together

**Restructure signals**:
- 20+ pages at root level
- Deep nesting with single-page directories
- Orphan pages

### Usage

```
/autowiki:reorganize
```

---

## /autowiki:serve (Deprecated)

**File**: `plugins/autowiki/commands/serve.md`

This command is deprecated. Use `npx autowiki` instead, which provides a better browsing experience with sidebar navigation, full-text search, dark mode, and syntax highlighting.

See [[Scripts]] for details on the npm-based web server.

---

## Command File Structure

All command files follow this structure:

```markdown
---
description: Brief description for /help
---

# /wiki:command - Title

Brief explanation.

## Pre-flight Checks
[Validation before execution]

## Process
[Step-by-step implementation]

## Output
[What gets created/modified]

## Error Handling
[Recovery procedures]
```

## Code References

- `plugins/autowiki/commands/init.md` - Init command definition
- `plugins/autowiki/commands/update.md` - Update command definition
- `plugins/autowiki/commands/reorganize.md` - Reorganize command definition
- `plugins/autowiki/commands/serve.md` - Serve command (deprecated)


================================================================================

FILE: wiki/configuration.md
----------------------------------------
---
title: Configuration
type: reference
tags: [configuration, settings, hooks, auto-update]
related:
  - "[[Commands]]"
  - "[[Architecture]]"
sources:
  - wiki/.config.yml
  - plugins/autowiki/hooks/
  - plugins/autowiki/.claude-plugin/
  - .claude-plugin/
---

# Configuration

The autowiki plugin uses several configuration files and data structures to control behavior, enable auto-updates, and support plugin distribution.

## Wiki Configuration

**File**: `wiki/.config.yml`
**Created by**: `/autowiki:init`

Controls wiki generation and update behavior.

### Default Configuration

From `wiki/.config.yml`:
```yaml
# Agent Wiki Configuration
# This file controls wiki behavior and is created by /wiki:init

# Automatically update wiki after agent tasks complete
# Set to false for manual-only updates via /wiki
auto_update: true

# How to organize wiki pages
# - concept: One page per identified concept (recommended)
# - directory: Mirror source directory structure
# - module: One page per detected module (package.json, etc.)
page_granularity: concept

# Paths to exclude from wiki exploration
# Supports glob patterns
exclude:
  - node_modules/
  - .git/
  - dist/
  - build/
  - coverage/
  - "*.min.js"
  - "*.lock"
  - "*.map"

# Maximum pages at wiki root before suggesting subdirectories
max_root_pages: 15

# Custom concept mappings (optional)
# Use this to group specific paths under named concepts
# concepts:
#   authentication:
#     - src/auth/
#     - src/middleware/auth*
```

### Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `auto_update` | boolean | `true` | Enable automatic wiki updates after tasks |
| `page_granularity` | string | `concept` | Page organization strategy |
| `exclude` | list | (see above) | Glob patterns to exclude from exploration |
| `max_root_pages` | integer | `15` | Max pages before subdirectory suggestion |
| `concepts` | object | (none) | Custom path-to-concept mappings |

### Page Granularity Options

- **concept** - One page per identified concept (recommended). Explorer agents identify logical units of functionality.
- **directory** - Mirror source directory structure. Each significant directory gets a page.
- **module** - One page per detected module boundary (package.json, go.mod, etc.)

---

## Wiki Index

**File**: `wiki/.index.json`
**Created by**: Wiki Coordinator agent

JSON index mapping pages to sources for fast lookups and change detection.

### Structure

```json
{
  "version": 1,
  "generated": "2026-01-19T00:00:00Z",
  "pages": {
    "overview": {
      "path": "wiki/overview.md",
      "title": "Repository Name",
      "type": "overview",
      "aliases": [],
      "sources": ["./"],
      "links_to": ["architecture", "commands"],
      "linked_from": []
    },
    "concept-name": {
      "path": "wiki/concept-name.md",
      "title": "Concept Name",
      "type": "concept",
      "aliases": ["alt-name"],
      "sources": ["src/concept/"],
      "links_to": ["other-concept"],
      "linked_from": ["overview"]
    }
  },
  "source_map": {
    "src/concept/": ["concept-name"],
    "src/concept/specific.ts": ["concept-name", "other-concept"]
  }
}
```

### Fields

**Root level**:
- `version` - Index format version
- `generated` - ISO timestamp of generation
- `pages` - Map of slug to page metadata
- `source_map` - Map of source paths to page slugs

**Page metadata**:
- `path` - Relative path to markdown file
- `title` - Human-readable title
- `type` - Page type (overview, concept, guide, reference)
- `aliases` - Alternative names for wikilink resolution
- `sources` - Source files/directories this page documents
- `links_to` - Outgoing wikilinks
- `linked_from` - Incoming wikilinks

### Usage

The index is used by:
- **Update command** - Maps changed files to affected pages (`commands/update.md:34-50`)
- **Web server** - Resolves wikilinks (`lib/scanner.js`)
- **Reorganize command** - Analyzes structure (`commands/reorganize.md:12-13`)

---

## Post-Task Hook

**File**: `plugins/autowiki/hooks/post-task.sh`
**Triggered by**: Claude Code after SubagentStop events
**Configured in**: `plugins/autowiki/hooks/hooks.json`

Detects if wiki updates are recommended after agent tasks complete.

### Hook Registration

From `hooks/hooks.json`:
```json
{
  "description": "Wiki auto-update hooks",
  "hooks": {
    "SubagentStop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/hooks/post-task.sh"
          }
        ]
      }
    ]
  }
}
```

### Behavior

From `hooks/post-task.sh`:

1. Check wiki/ directory exists
2. Check `auto_update: true` in config
3. Compare current HEAD to `wiki/.last-update`
4. Filter to relevant code changes (excluding wiki/, .md, .txt)
5. If changes exist, output `WIKI_UPDATE_RECOMMENDED`

---

## Plugin Manifest

**File**: `plugins/autowiki/.claude-plugin/plugin.json`

Registers the plugin with Claude Code.

```json
{
  "name": "autowiki",
  "description": "Maintains an auto-updating wiki for agent context about how repository components work",
  "version": "1.2.4",
  "author": {
    "name": "anyweez"
  }
}
```

---

## Marketplace Configuration

**File**: `.claude-plugin/marketplace.json`

Enables plugin distribution via Claude Code marketplace system.

```json
{
  "$schema": "https://anthropic.com/claude-code/marketplace.schema.json",
  "name": "autowiki",
  "version": "1.2.4",
  "description": "Auto-updating wiki for agent context",
  "owner": {
    "name": "anyweez"
  },
  "plugins": [
    {
      "name": "autowiki",
      "description": "Maintains an auto-updating wiki for agent context",
      "version": "1.2.4",
      "author": {
        "name": "anyweez"
      },
      "source": "./plugins/autowiki",
      "category": "productivity"
    }
  ]
}
```

### Installation

In Claude Code, run:

```
/plugins
```

Select **Add a marketplace**, then enter:

```
anyweez/autowiki
```

Then select **autowiki** from the marketplace to install it.

---

## Last Update Marker

**File**: `wiki/.last-update`
**Updated by**: Update command

Contains the git commit hash of the last wiki update.

```
a1b2c3d4e5f6...
```

Used by:
- `commands/update.md` - Determines what changed since last update
- `hooks/post-task.sh` - Checks for relevant changes

Updated after successful wiki update:
```bash
git rev-parse HEAD > wiki/.last-update
```

## Code References

- `wiki/.config.yml` - Wiki configuration
- `plugins/autowiki/hooks/hooks.json` - Hook registration
- `plugins/autowiki/hooks/post-task.sh` - Post-task hook
- `plugins/autowiki/.claude-plugin/plugin.json` - Plugin manifest
- `.claude-plugin/marketplace.json` - Marketplace config


================================================================================

FILE: wiki/scripts.md
----------------------------------------
---
title: Scripts
type: reference
tags: [scripts, llms-txt, server, utilities, npm]
related:
  - "[[Commands]]"
  - "[[Architecture]]"
  - "[[Configuration]]"
sources:
  - plugins/autowiki/scripts/
  - bin/
  - lib/
---

# Scripts

autowiki includes a Node.js script for generating llms.txt files and an npm package for browsing the wiki locally. The web server has been moved out of the plugin and into the main npm package (`npx autowiki`).

## generate-llms.js

**File**: `plugins/autowiki/scripts/generate-llms.js`
**Language**: Node.js 16+
**Dependencies**: None (pure Node.js)

Generates `llms.txt` and `llms-full.txt` from wiki pages for AI discoverability.

### Usage

```bash
node scripts/generate-llms.js [--wiki-dir wiki/]
```

### Output Files

**llms.txt** - Index file with links to all wiki pages:
```
# Repository Wiki

> Agent-maintained documentation for understanding this codebase.

## Quick Start
This wiki is designed for AI agents...

## Overview
- [Overview](wiki/overview.md): Repository overview...

## Concepts
- [Authentication](wiki/authentication.md): Auth system...
```

**llms-full.txt** - Complete content dump:
```
# Repository Wiki - Complete Content

================================================================================

FILE: wiki/overview.md
----------------------------------------
[full page content]

================================================================================
```

### Key Functions

**`parseFrontmatter(content)`** (`generate-llms.js:27-99`)
- Extracts YAML frontmatter and body from markdown
- Inline implementation (no external YAML dependency)
- Returns object with `frontmatter` and `body`

**`getFirstParagraph(body)`** (`generate-llms.js:102-134`)
- Extracts first non-heading paragraph as description
- Truncates to 200 characters

**`collectWikiPages(dir, base)`** (`generate-llms.js:136-167`)
- Recursively collects all .md files
- Skips hidden files/directories
- Returns list of page metadata dicts

**`generateLlmsTxt(pages, wikiDirPath, repoName)`** (`generate-llms.js:195-242`)
- Groups pages by type (overview, concept, guide, reference)
- Generates formatted index content

**`generateLlmsFullTxt(pages, repoName)`** (`generate-llms.js:244-270`)
- Concatenates all page content
- Sorts with overview first, then alphabetically

**`getRepoName(wikiDirPath)`** (`generate-llms.js:169-193`)
- Attempts to determine repo name from package.json or pyproject.toml
- Falls back to directory name

### Integration

Called by commands after wiki generation/update:
```bash
node scripts/generate-llms.js
```

---

## Web Server (npx autowiki)

The wiki web server is distributed as the `autowiki` npm package. It replaces the previous plugin-based `/autowiki:serve` command.

### CLI Entry Point

**File**: `bin/autowiki.js`

Parses CLI arguments and starts the server or exports static HTML.

```bash
npx autowiki [options]

  --port <number>     Port to listen on (default: 3000)
  --wiki-dir <path>   Wiki directory (default: auto-detect from git root)
  --export            Export static HTML instead of starting server
  --output <path>     Output directory for export (default: wiki-html/)
  --open              Auto-open browser after starting server
  -h, --help          Show help message
```

Wiki directory auto-detection: Uses `git rev-parse --show-toplevel` to find the repo root, then looks for `wiki/` there. Falls back to `./wiki` in the current directory.

### Library Modules

**`lib/server.js`** - HTTP server with routing and static export
- `startServer(wikiDir, port, open)` - Starts the HTTP server
- `exportSite(wikiDir, outputDir)` - Generates static HTML files

**`lib/renderer.js`** - Markdown rendering pipeline
- Configures markdown-it with wikilink support
- Handles frontmatter extraction

**`lib/scanner.js`** - Wiki page scanner and frontmatter parser
- Scans wiki directory for pages
- Parses YAML frontmatter
- Builds title-to-path mappings for wikilink resolution

**`lib/highlight.js`** - Syntax highlighting for code blocks
- Language-aware code highlighting

**`lib/template.js`** - HTML template and styling
- Sidebar navigation with pages grouped by type
- Client-side search (Ctrl+K / Cmd+K)
- Dark mode support (CSS media query)
- Responsive layout

### Server Features

1. **Sidebar navigation** - Pages grouped by type (overview, concepts, guides, reference)
2. **Full-text search** - Client-side search triggered by Ctrl+K / Cmd+K
3. **Wikilink support** - Resolves `[[Page Name]]` syntax to proper links
4. **Dark mode** - CSS media query for `prefers-color-scheme: dark`
5. **Syntax highlighting** - Language-aware code block highlighting
6. **Static export** - Generate standalone HTML files with `--export`

### Wikilink Resolution

The scanner builds a title-to-path map from `.index.json`:

Resolution order:
1. Exact title match (case-insensitive)
2. Slug match
3. Alias match
4. Fall back to slugified target

### Export Mode

When `--export` flag is set:
1. Creates output directory
2. Recursively processes wiki directory
3. Renders each .md file to .html
4. Copies non-markdown files as-is
5. Generates index.html

### Routes

| Path | Response |
|------|----------|
| `/` | Redirects to `/overview` |
| `/overview` | Rendered overview.md |
| `/[page-name]` | Rendered [page-name].md |
| `/index` | Auto-generated page list |
| `/llms.txt` | Raw llms.txt content |
| `/.index.json` | Raw index JSON |

---

## Dependencies

**Root package.json** (npm package):
```json
{
  "dependencies": {
    "markdown-it": "^14.0.0",
    "markdown-it-wikilinks": "^1.2.0"
  }
}
```

**Plugin package.json** (`plugins/autowiki/package.json`):
```json
{
  "dependencies": {
    "markdown-it": "^14.0.0",
    "markdown-it-wikilinks": "^1.2.0"
  }
}
```

No Python dependencies are required.

## Code References

- `plugins/autowiki/scripts/generate-llms.js` - llms.txt generator (304 lines)
- `bin/autowiki.js` - CLI entry point (89 lines)
- `lib/server.js` - HTTP server
- `lib/renderer.js` - Markdown rendering
- `lib/scanner.js` - Page scanning and frontmatter
- `lib/highlight.js` - Code highlighting
- `lib/template.js` - HTML template and styles


================================================================================
